---
// src/pages/login.astro
import Layout from '../layouts/Layout.astro';
---
<Layout title="Iniciar Sesión">
  <main class="flex items-center justify-center min-h-screen">
    <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md">
      <h1 class="text-2xl font-bold text-center">
        Bienvenido
      </h1>

      <form id="auth-form" class="space-y-4">
        <div>
          <label for="email" class="block mb-2 text-sm font-medium">Correo Electrónico</label>
          <input 
            type="email" 
            id="email" 
            class="w-full px-3 py-2 border rounded-lg" 
            placeholder="tu@correo.com"
            required 
          />
        </div>
        <div>
          <label for="password" class="block mb-2 text-sm font-medium">Contraseña</label>
          <input 
            type="password" 
            id="password" 
            class="w-full px-3 py-2 border rounded-lg" 
            placeholder="••••••••"
            required 
          />
        </div>
        
        <div class="flex flex-col gap-2">
          <button type="submit" id="login-button" class="w-full px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700">
            Iniciar Sesión
          </button>
          <button type="submit" id="register-button" class="w-full px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700">
            Registrarse
          </button>
        </div>
      </form>
      <p id="feedback-message" class="text-sm text-center h-4"></p>
    </div>
  </main>
  <script>
  import { signIn, signUp } from '../firebase/auth';

  // OBTENEMOS los elementos
  const emailInput = document.getElementById('email') as HTMLInputElement;
  const passwordInput = document.getElementById('password') as HTMLInputElement;
  const loginButton = document.getElementById('login-button');
  const registerButton = document.getElementById('register-button');
  // AÑADIMOS la referencia al nuevo párrafo
  const feedbackMessage = document.getElementById('feedback-message');

  // Listener para el botón de INICIAR SESIÓN
  loginButton?.addEventListener('click', async (event) => {
    event.preventDefault(); 
    
    // Limpiamos mensajes anteriores
    if (feedbackMessage) feedbackMessage.textContent = '';
    
    const result = await signIn(emailInput.value, passwordInput.value);

    if (result.success) {
      window.location.href = '/dashboard';
    } else {
      // Si hay error, lo mostramos en el párrafo en rojo
      if (feedbackMessage && result.error) {
        feedbackMessage.textContent = result.error;
        feedbackMessage.style.color = 'red';
      }
    }
  });

  // Listener para el botón de REGISTRARSE
  registerButton?.addEventListener('click', async (event) => {
    event.preventDefault();
    
    if (feedbackMessage) feedbackMessage.textContent = '';
    
    const result = await signUp(emailInput.value, passwordInput.value);

    if (result.success) {
      // Si el registro es exitoso, mostramos un mensaje en verde
      if (feedbackMessage) {
        feedbackMessage.textContent = '¡Registrado exitosamente! Redirigiendo...';
        feedbackMessage.style.color = 'green';
      }
      // Esperamos un momento para que el usuario vea el mensaje y luego redirigimos
      setTimeout(() => {
        window.location.href = '/dashboard';
      }, 1500); // 1.5 segundos
    } else {
      // Si hay error, lo mostramos en el párrafo en rojo
      if (feedbackMessage && result.error) {
        feedbackMessage.textContent = result.error;
        feedbackMessage.style.color = 'red';
      }
    }
  });
</script>
</Layout>