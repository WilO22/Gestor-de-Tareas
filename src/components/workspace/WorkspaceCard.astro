---
// src/components/workspace/WorkspaceCard.astro
// Componente mejorado de tarjeta para un Workspace usando BaseCard

import BaseCard from '../base/BaseCard.astro';
import { formatRelativeTime } from '../../utils/date.utils';

export interface Props {
  id: string;
  title: string;
  description?: string;
  memberCount?: number;
  boardCount?: number;
  lastActivity?: Date;
  isOwner?: boolean;
  color?: 'blue' | 'green' | 'purple' | 'pink' | 'indigo' | 'red' | 'yellow' | 'gray';
}

const { 
  id, 
  title, 
  description, 
  memberCount = 0, 
  boardCount = 0, 
  lastActivity, 
  isOwner = false,
  color = 'blue'
} = Astro.props;

// Generar iniciales del workspace
function getWorkspaceInitials(title: string): string {
  return title
    .split(' ')
    .map(word => word.charAt(0))
    .join('')
    .toUpperCase()
    .slice(0, 2);
}

// Colores disponibles para workspace
type ColorKey = 'blue' | 'green' | 'purple' | 'pink' | 'indigo' | 'red' | 'yellow' | 'gray';
const colorClasses: Record<ColorKey, string> = {
  blue: 'bg-blue-500',
  green: 'bg-green-500',
  purple: 'bg-purple-500',
  pink: 'bg-pink-500',
  indigo: 'bg-indigo-500',
  red: 'bg-red-500',
  yellow: 'bg-yellow-500',
  gray: 'bg-gray-500'
};
---

<BaseCard
  href={`/workspace/${id}/boards`}
  title={title}
  subtitle={description}
  variant="elevated"
  size="md"
  avatar={true}
  footer={true}
  class="workspace-card hover:scale-105 transition-transform duration-200"
>
  <!-- Avatar del workspace -->
  <div slot="avatar" class={`w-12 h-12 ${colorClasses[color]} rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-md`}>
    {getWorkspaceInitials(title)}
  </div>
  
  <!-- Contenido principal -->
  <div class="space-y-3">
    
    <!-- Badges de rol -->
    {isOwner && (
      <div class="flex items-center">
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
          <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
          </svg>
          Propietario
        </span>
      </div>
    )}
    
    <!-- Estadísticas del workspace -->
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div class="flex items-center space-x-2 text-gray-600">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
        </svg>
        <span>{boardCount} {boardCount === 1 ? 'tablero' : 'tableros'}</span>
      </div>
      
      <div class="flex items-center space-x-2 text-gray-600">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m3 5.197H9m3 0a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        <span>{memberCount} {memberCount === 1 ? 'miembro' : 'miembros'}</span>
      </div>
    </div>
  </div>
  
  <!-- Footer con actividad reciente -->
  <div slot="footer" class="flex items-center justify-between text-xs text-gray-500">
    <div class="flex items-center space-x-1">
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span>
        {lastActivity 
          ? `Actualizado ${formatRelativeTime(lastActivity)}`
          : 'Sin actividad reciente'
        }
      </span>
    </div>
    
    <!-- Indicador de acceso rápido -->
    <div class="opacity-0 group-hover:opacity-100 transition-opacity">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
      </svg>
    </div>
  </div>
</BaseCard>

<style>
  .workspace-card:hover .group-hover\:opacity-100 {
    opacity: 1;
  }
</style>